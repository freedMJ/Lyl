

{%load static%}
{% load filters %}
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>联金数据库查询系统</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
    <script type="text/javascript">
    	$(document).ready(function(){
    		//获得当前时间戳
    		var end_timestamp =Date.parse(new Date())
    		//装换成当前时间
    		var end_time=timestampToTime(end_timestamp)
    		//获得过去一小时时间戳
    		var start_timestemp=end_timestamp-3600000;
    		//转化成过去一小时时间
    		var start_time=timestampToTime(start_timestemp);
    		$("#startTime").val(start_time);
    		$("#endTime").val(end_time);
    		$("#bt").click(function(){
    			//获得开始时间戳和结束时间戳
    			var start_time=$("#startTime").val();
    			var end_time=$("#endTime").val();
    			//判断输入的时间格式是否正确
    			var reg=/^[1-9]\d{3}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])\s+(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/;
    			var start_time_z=start_time.match(reg);
    			var end_time_z=end_time.match(reg);
    			if(start_time_z==null){
    				alert("请输入正确的开始时间")
    			}
    			if(end_time_z==null){
    				alert("请输入正确的结束时间")
    			}
    			//输入的时间格式正确，转化成时间戳
 				var start_timestemp=timeToTimestamp(start_time);
 				var end_timestamp=timeToTimestamp(end_time);   			
    			//获得订单种类，分发联金状态
    			var orderType=$("#orderType").val();
    			var isfilled=$("#isfilled").val()
    			//判断订单种类，分发联金状态是否选择
    			if(orderType=="0"){
    				alert("请选择订单种类")
    			};
    			if(isfilled=="0"){
    				alert("请选择分发联金状态")
    			};
    			var data={
    				"start_timestemp":start_timestemp,
    				"end_timestamp":end_timestamp,
    				"orderType":orderType,
    				"isfilled":isfilled
    			}
    			var data_json=JSON.stringify(data);
    			//调用ajax向后端传输数据






    		});
    	});


    	//得到时间
    	function timestampToTime(timestamp) {
     		var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
     		var Y = date.getFullYear() + '-';
     		var M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
     		var D = date.getDate() + ' ';
     		var h = date.getHours();
     		if(h<10){
     			h='0'+h+ ':';;
     		}else{
     			h=h+ ':';
     		}
     		var m = date.getMinutes();
     		if(m<10){
     			m='0'+m+ ':';;
     		}else{
     			m=m+ ':';
     		}
     		var s = date.getSeconds();
     		if(s<10){
     			s='0'+s;
     		}else{
     			s=s;
     		}
     		return Y+M+D+h+m+s;
    	}
     	//得到时间戳
     	function timeToTimestamp(time){
     		var time_str=time+":000";
     		var s =time_str;
            s = s.replace(/-/g,"/");
     		var date = new Date(s);
		    // 有三种方式获
		    var timestamp =(Date.parse(date))/1000;
		    return timestamp;
     	}
    
   
    </script>
  </head>
  <body>
    <div >
	<div style="display: inline; bottom: 30px;" >
	<h1 style="display: inline; " >联金数据库查询系统 </h1>
	</div>
	<span><img src="{% static 'images/1528175965.png' %}" style="height: 73px;width: 255px;" id="im"></span><br>
	<form class="form-inline" action=''>
		<div class="form-group">
		  <label for="exampleInputName2">开始时间</label>
		  <input type="text" class="form-control" id="startTime">
		</div>
		<div class="form-group">
		  <label for="exampleInputName2">结束时间</label>
		  <input type="text" class="form-control" id="endTime">
		</div>
		<select class="form-control" id="orderType">
			<option value="0">--请选择订单种类--</option>
			<option value="1">全部订单</option>
			<option value="2">按摩枕订单</option>
			<option value="3">游戏订单</option>
        </select>
        <select class="form-control" id="isfilled">
        	<option value="0">--请选择分发联金状态--</option>
			<option value="1">已分发和未分发总订单</option>
			<option value="2">已分发联金订单</option>
			<option value="3">未分发联金订单</option>
        </select>
		<button type="button" class="btn btn-default" id="bt">查询</button>
    </form>
	<a href="/index">返回首页</a>
	{% if olength == 0 %}
		<p>当前联金都已经正常发放了</p>
	{% else  %}
		<p style="color: red">当前共{{olength}}笔交易未分发成功联金</p>
		<p style="color: red">当前共{{len_pindex}}页，一页共25条记录，当前是第{{page.number}}页</p>
	{% endif %}
	

	</div>
    <table class="table table-condensed">
  		
  		<thead >
			<tr>
				<th>交易记录</th>
				<th>id</th>
				<th>用户标识</th>
				<th>订单号</th>
				<th>交易服务费</th>
				<th>交易时间</th>
				<th>是否分发</th>
			</tr>
		</thead>
		<tbody>	
			{% for o in page.object_list %}
			<tr>
				<td>{{forloop.counter}}</td>
				<td>{{o.id}}</td>
				<td>{{o.usertoken}}</td>
				<td>{{o.orderno}}</td>
				<td>{{o.orderamount}}</td>
				<td>{{ o.created_at|get_times}}</td>
				<!--<td>{{ o.created_at}}</td>-->
				{% if o.is_filled == 0 %}
					<td style="color: red">未分发</td>
				{% else %}
					<td style="color: green">已分发</td>
				{% endif %}
			</tr>
			{% endfor %}
		</tbody>
		<nav aria-label="Page navigation">
					<ul class="pagination">

					  {% if  page.previous_page_number > 0 %}
					  <li>
					    <a href="/result_time{{page.previous_page_number}}" aria-label="Previous">
					      <span aria-hidden="true">«</span>
					    </a>
					  </li>
					  {% endif %}

					  {% for page_num in page_list %}
					          {% if page_num == page.number %}
					              <li class="active"><a href="#" ">{{ page_num }}</a></li>
					          {% else %}
					              <li><a href="/result_time{{ page_num }}">{{ page_num }}</a></li>
					          {% endif %}
					  {% endfor %}

					  {% if page.has_next %}
					  <li>
					    <a href="/result_time{{page.next_page_number}}" aria-label="Next">
					      <span aria-hidden="true">»</span>
					    </a>
					  </li>
					  {% endif %}

					</ul>
        </nav>
			   </table>

			    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
			    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
			    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
			    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
  </body>
</html>